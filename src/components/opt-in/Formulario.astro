<section class="py-[60px] md:py-[80px]">
	<div class="tcp-container">
		<h5
			class="text-[#3B4FFF] text-balance font-semibold text-center text-[16px] md:text-[18px] my-4 md:mt-8"
		>
			Â¡El momento perfecto para cambiar no existe!
		</h5>
		<h3
			class="text-[#111] font-semibold text-[28px] text-center md:text-[32px] mb-8 max-w-[820px] mx-auto leading-[120%]"
		>
			Registrate ahora y descubrÃ­ las 4 claves para salir del vacÃ­o y
			conectar con tu propÃ³sito de vida.
		</h3>
		<div class="grid md:grid-cols-2 gap-8">
			<div>
				<div
					class="bg-[#3B4FFF] rounded-lg px-[16px] py-[64px] md:p-[72px] overflow-clip relative max-w-full"
				>
					<img
						src="/images/form-bg.webp"
						alt="Fondo del formulario"
						class="w-full h-full object-cover absolute left-0 top-0 mix-blend-overlay"
					/>
					<div class="md:w-[380px] w-full mx-auto relative">
						<form action="" id="webhookForm">
							<label
								for="email"
								class="text-[#fff] font-medium mb-4 block"
							>
								Tu correo electronico
								<input
									type="email"
									name="email"
									placeholder="rompiendoelciclo@gmail.com"
									class="w-full p-[16px] rounded-[6px] bg-[#fff] mt-2 text-[#111]/60 placeholder:text-[14px] font-normal"
								/>
							</label>
							<label
								for="phone"
								class="text-[#fff] font-medium block"
							>
								Tu nÃºmero de WhatsApp
								<div class="flex gap-2 mt-2">
									<select
										name="countryCode"
										id="countryCode"
										class="p-[16px] rounded-[6px] bg-[#fff] text-[#111]/80 font-normal"
									>
										<!-- SudamÃ©rica -->
										<option value="+54">ğŸ‡¦ğŸ‡· AR</option>
										<option value="+591">ğŸ‡§ğŸ‡´ BO</option>
										<option value="+55">ğŸ‡§ğŸ‡· BR</option>
										<option value="+56">ğŸ‡¨ğŸ‡± CL</option>
										<option value="+57">ğŸ‡¨ğŸ‡´ CO</option>
										<option value="+593">ğŸ‡ªğŸ‡¨ EC</option>
										<option value="+595">ğŸ‡µğŸ‡¾ PY</option>
										<option value="+51">ğŸ‡µğŸ‡ª PE</option>
										<option value="+598">ğŸ‡ºğŸ‡¾ UY</option>
										<option value="+58">ğŸ‡»ğŸ‡ª VE</option>

										<!-- CentroamÃ©rica -->
										<option value="+501">ğŸ‡§ğŸ‡¿ BZ</option>
										<option value="+506">ğŸ‡¨ğŸ‡· CR</option>
										<option value="+507">ğŸ‡µğŸ‡¦ PA</option>
										<option value="+502">ğŸ‡¬ğŸ‡¹ GT</option>
										<option value="+504">ğŸ‡­ğŸ‡³ HN</option>
										<option value="+505">ğŸ‡³ğŸ‡® NI</option>
										<option value="+503">ğŸ‡¸ğŸ‡» SV</option>

										<!-- NorteamÃ©rica -->
										<option value="+1">ğŸ‡ºğŸ‡¸ US</option>
										<option value="+1">ğŸ‡¨ğŸ‡¦ CA</option>
										<option value="+52">ğŸ‡²ğŸ‡½ MX</option>

										<!-- Caribe -->
										<option value="+53">ğŸ‡¨ğŸ‡º CU</option>
										<option value="+1">ğŸ‡©ğŸ‡´ DO</option>
										<option value="+1">ğŸ‡¯ğŸ‡² JM</option>
										<option value="+1">ğŸ‡¹ğŸ‡¹ TT</option>
										<option value="+1">ğŸ‡§ğŸ‡¸ BS</option>
										<option value="+1">ğŸ‡§ğŸ‡§ BB</option>
										<option value="+1">ğŸ‡¦ğŸ‡¬ AG</option>
										<option value="+1">ğŸ‡°ğŸ‡³ KN</option>
										<option value="+1">ğŸ‡±ğŸ‡¨ LC</option>
										<option value="+1">ğŸ‡»ğŸ‡¨ VC</option>
									</select>
									<input
										type="tel"
										name="phone"
										id="phoneInput"
										placeholder="2616841853"
										class="w-full p-[16px] rounded-[6px] bg-[#fff] text-[#111]/60 placeholder:text-[14px] font-normal"
									/>
								</div>
							</label>
							<label for="date" class="text-[#fff] font-medium block mt-6">
								Elige tu fecha
								<select
									name="date"
									id="date"
									class="w-full p-[16px] rounded-[6px] bg-[#fff] mt-2 text-[#111]/80 font-normal"
								>
									<option value="Domingo 4 de mayo 19 hs (hora Argentina)">Domingo 4 de mayo 19 hs (hora Argentina)</option>
									<option value="Martes 6 de mayo 19 hs (hora Argentina)">Martes 6 de mayo 19 hs (hora Argentina)</option>
								</select>
							</label>
							<button
								type="submit"
								class="bg-[#FF7A22] px-6 py-4 text-white font-semibold rounded-sm mx-auto block w-full cursor-pointer mt-6"
							>
								Quiero asistir a la Masterclas Gratuita.
							</button>
						</form>
					</div>
				</div>
				<div class="md:py-8 max-w-full">
					<p class="mb-4 font-semibold">
						De esta Masterclass te vas a llevar:
					</p>
					<ul class="list-inside">
						<li class="mb-4 flex gap-2">
							<svg
								class="size-[20px] min-w-[20px]"
								xmlns="http://www.w3.org/2000/svg"
								viewBox="0 0 448 512"
								fill="#FF7A22"
								><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
								<path
									d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"
								></path></svg
							>
							Absoluta claridad de por donde NO es tu camino.
						</li>
						<li class="mb-4 flex gap-2">
							<svg
								class="size-[20px] min-w-[20px]"
								xmlns="http://www.w3.org/2000/svg"
								viewBox="0 0 448 512"
								fill="#FF7A22"
								><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
								<path
									d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"
								></path></svg
							>
							Descubrir cual es el APRENDIZAJE detras de lo que te
							esta pasando.
						</li>
						<li class="mb-4 flex gap-2">
							<svg
								class="size-[20px] min-w-[20px]"
								xmlns="http://www.w3.org/2000/svg"
								viewBox="0 0 448 512"
								fill="#FF7A22"
								><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
								<path
									d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"
								></path></svg
							>
							Aprender como ATRAVESAR este momento para dejar de sentir
							angustia y ansiedad.
						</li>
						<li class="mb-4 flex gap-2">
							<svg
								class="size-[20px] min-w-[20px]"
								xmlns="http://www.w3.org/2000/svg"
								viewBox="0 0 448 512"
								fill="#FF7A22"
								><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
								<path
									d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"
								></path></svg
							>
							Descrubir en quien te podes convertir y cual es todo
							tu POTENCIAL.
						</li>
					</ul>
				</div>
			</div>
		</div>
	</div>

	<script>
		const WEBHOOK_URL = "https://hook.us2.make.com/6r4yj1ft4iviusogbeshmaayv1rqu9vk"
		const TY_URL = "/thankyou";
		document
			.querySelectorAll<HTMLFormElement>("#webhookForm")
			.forEach((form) => {
				form.addEventListener("submit", async function (event) {
					event.preventDefault();

					const formData = new FormData(this);
					const data = Object.fromEntries(formData.entries());

					console.log(data);
					sendConversion(data);

					try {
						const response = await fetch(
						WEBHOOK_URL,
							{
								method: "POST",
								headers: { "Content-Type": "application/json" },
								body: JSON.stringify(data),
							},
						);

						if (response.ok) {
							window.location.href = TY_URL
						} else {
							alert("Error al enviar el formulario.");
						}
					} catch (error) {
						alert("Hubo un problema al enviar los datos.");
					}
				});
			});
		const sendConversion = async (data: any) => {
			console.log("DATA: ", data.email);

			const hashEmail = await hashSHA256(data.email);
			const hashPhone = await hashSHA256(data.phone);

			const response = await fetch(
				"https://graph.facebook.com/v18.0/4313125762161146/events?access_token=EAAYWvFTPrFIBOyCEu5yITXvaxZCt4LnUpDzgvzvbKEMVrrz4rhUQMmmI6IhOJeYGsSGrOnuLZCEn7GQyOnoO0OlVzNJZCKU6Nir7eTVsw7ksOZB56o6BVqax4RZBjOzxtE1X9Lwlk49DCjZCsPFB1ZCaSWcw6DZAVmWKJhRwZB0FYd2CxnXJqRtywN23HLFrsJp0dugZDZD",
				{
					method: "POST",
					headers: {
						"Content-Type": "application/json",
					},
					body: JSON.stringify({
						data: [
							{
								event_name: "Lead",
								event_time: Math.floor(Date.now() / 1000), // tiempo actual en segundos
								action_source: "website",
								user_data: {
									em: [hashEmail],
									ph: [hashPhone],
								},
								original_event_data: {
									event_name: "Lead",
									event_time: Math.floor(Date.now() / 1000),
								},
							},
						],
					}),
				},
			);

			const result = await response.json();
			console.log("Respuesta de API Meta: ", result);
		};

		async function hashSHA256(value: String) {
			const encoder = new TextEncoder();
			const data = encoder.encode(value.trim().toLowerCase()); // sin espacios, en minÃºsculas
			const hashBuffer = await crypto.subtle.digest("SHA-256", data);
			const hashArray = Array.from(new Uint8Array(hashBuffer));
			return hashArray
				.map((b) => b.toString(16).padStart(2, "0"))
				.join("");
		}
	</script>
</section>
